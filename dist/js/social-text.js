!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SocialText=e():t.SocialText=e()}(self,(function(){return(()=>{"use strict";var t={207:(t,e)=>{e.__esModule=!0,e.Api=void 0;var n=function(){var t=this;this.activeBlockSubject=new o,this.activeBlockSubject.subscribe((function(e){t.block=e}))};e.Api=n;var o=function(){function t(){this.observers=[],this.observers=[]}return t.prototype.subscribe=function(t){this.observers.push(t)},t.prototype.next=function(t){this.observers.forEach((function(e){return e(t)}))},t}()},962:(t,e,n)=>{e.__esModule=!0,e.App=void 0;var o=n(207),r=n(303),i=n(969),l=n(328),s=n(9),a=function(){function t(){this._api=new o.Api,this._socialPlugins={},this._loadInternalPlugins(),this._bootstrap()}return t.prototype.register=function(t,e){if(null!=this._socialPlugins[t])throw new Error("Plugin "+t+" is already loaded");this._socialPlugins[t]=e,console.log("AppPlugin: Registered",t)},t.prototype.extend=function(t,e){if(null==this._socialPlugins[t])throw new Error("Plugin "+t+" cannot be extended, it is not loaded yet");e.trigger&&(this._socialPlugins[t].trigger=e.trigger),e&&(this._socialPlugins[t].properties=e),console.log("AppPlugin: Extended",t)},t.prototype._bootstrap=function(){var t=this;window.addEventListener("load",(function(){for(var e in t._socialPlugins){if(null==typeof t._socialPlugins[e])throw new Error("Plugin "+e+" failed to load")}new r.EditorManager(t._api).setPlugins(t._socialPlugins)}))},t.prototype._loadInternalPlugins=function(){this.register("hashtag",{trigger:/[\s.,;:!?]/,exec:i.HashTagPlugin}),this.register("link",{trigger:/\s/,exec:s.LinkPlugin}),this.register("header",{trigger:"Enter",exec:l.HeaderPlugin})},t}();e.App=a},332:(t,e)=>{e.__esModule=!0,e.Block=void 0;var n=function(){function t(t,e){this.blockID=t,this.blockElement=e,this.content="",this.fragments=[]}return t.prototype.trigger=function(t){this.triggerEvent=t},t.prototype.update=function(t){this.content=t,this.fragments=[],this._contentToFragment()},t.prototype.publish=function(t){var e="";/[\s.,;:!?]+/gi.test(this.lastChar())&&(e=this.lastChar().replace(/[\s.,;:!?]+/gi,(function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e[1]?e[1]:t}))),this._insertTextAtCaret(t+e)},t.prototype.onUpdate=function(){return this.blockElement},t.prototype.rawHTML=function(){return this.blockElement.innerHTML.replace("&nbsp;"," ").trim()},t.prototype.rawText=function(){return this.blockElement.innerText.trim()},t.prototype.decodeHtml=function(t){var e=document.createElement("textarea");return e.innerHTML=t,e.value},t.prototype.allWords=function(){try{return this.fragments.slice(-1).pop().nodeValue.split(/\s/)}catch(t){return[]}},t.prototype.lastWord=function(){try{return this.fragments.slice(-1).pop().nodeValue.split(/\s/).pop()}catch(t){return""}},t.prototype.lastChar=function(){return this.blockElement.innerText.slice(-1)},t.prototype.getText=function(){return this.blockElement.innerText},t.prototype.applyAttributes=function(t,e){for(var n in t)e?e.setAttribute(n,t[n]):this.blockElement.setAttribute(n,t[n])},t.prototype.applyStyes=function(t,e){var n=[];for(var o in t)n.push(o+":"+t[o]);e?e.style.cssText=n.join(";"):this.blockElement.style.cssText=n.join(";")},t.prototype.applyClasses=function(t,e){var n,o;e?(n=e.classList).add.apply(n,t):(o=this.blockElement.classList).add.apply(o,t)},t.prototype._contentToFragment=function(){var t=document.createElement("div");t.innerHTML=this.content;for(var e,n=document.createDocumentFragment();e=t.firstChild;)this.fragments.push(n.appendChild(e))},t.prototype._insertTextAtCaret=function(t){var e,n;if(window.getSelection){var o=window.getSelection();if(o.getRangeAt&&o.rangeCount){var r=o.getRangeAt(0);r.setEnd(this.blockElement,0),r.deleteContents();var i=document.createElement("div");i.innerHTML=t;for(var l=document.createDocumentFragment(),s=void 0,a=void 0;s=i.firstChild;)a=l.appendChild(s);if(this.blockElement.innerHTML="",r.insertNode(l),"Enter"!==this.triggerEvent.key)a?((r=r.cloneRange()).setStartAfter(a),r.collapse(!0),o.removeAllRanges(),o.addRange(r)):console.log("NO LAST NODE");else{for(var c=void 0,u=this.blockElement.parentNode.children,p=0;p<u.length;p++){if((null===(n=null===(e=u[p])||void 0===e?void 0:e.dataset)||void 0===n?void 0:n.block)==this.blockID){c=u[p+1];break}}if(c){this._clearSelection();var g=c.firstChild,d=document.createRange();d.setStart(g,0),d.setEnd(g,0),d.deleteContents();var h=window.getSelection();h.removeAllRanges(),h.addRange(d)}}}}},t.prototype._clearSelection=function(){window.getSelection&&(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges())},t}();e.Block=n},303:(t,e,n)=>{e.__esModule=!0,e.EditorManager=void 0;var o=n(305),r=n(332),i=n(305),l=function(){function t(t){var e=this;this.api=t,this._blocks={},this._plugins={},this._getAllContentEditable().forEach((function(t){e._initBlocks(t),e._setEditorEvents(t)}))}return t.prototype.setPlugins=function(t){this._plugins=t},t.prototype._getAllContentEditable=function(){return document.querySelectorAll("[contenteditable]")},t.prototype._initBlocks=function(t){var e=this;this._findBlocks(t,o.blockTags).forEach((function(t){var n=e._getBlockID(t)||e._setBlockID(t);e._blocks[n]=new r.Block(n,t)}))},t.prototype._processTriggers=function(t){if(this._activeBlock)for(var e in this._plugins)if(this._plugins[e]){var n=!1,o=void 0,r=this._activeBlock.blockElement.innerText.slice(-1);switch(typeof this._plugins[e].trigger){case"object":n=this._plugins[e].trigger.test(r)||"Enter"===t.key;break;case"string":o=this._plugins[e].trigger,n=t.key===o}n&&(this._activeBlock.trigger(t),this._plugins[e].exec(this.api,this._plugins[e].properties,t))}},t.prototype._setEditorEvents=function(t){var e=this;t.addEventListener("keyup",(function(t){if(e._activeBlock&&e._processTriggers(t),"Enter"===t.key&&!t.shiftKey){var n=e._getSelectionStart(),l=e._getParentBlock(n);if(l&&l.tagName.toLowerCase()===i.DefaultBlockTags.UL)return;var s=n.tagName.toLowerCase();0===o.blockTags.filter((function(t){return t==s})).length&&(n=l);var a=e._generateNewBlockID();return n.dataset.block=a,e._blocks[a]=new r.Block(a,n),e._activeBlock=e._blocks[a],void e.api.activeBlockSubject.next(e._blocks[a])}if("Enter"!==t.key&&!t.shiftKey){var c=n=e._getSelectionStart(),u=n.dataset.block;u||(u=(c=e._getParentBlock(n)).dataset.block),e._blocks[u]&&(e._blocks[u].update(c.innerHTML),e._activeBlock&&e._activeBlock.blockID==u||(e._activeBlock=e._blocks[u],e.api.activeBlockSubject.next(e._blocks[u])))}}))},t.prototype._getParentBlock=function(t){return t.closest("[data-block]")},t.prototype._getSelectionStart=function(){var t=document.getSelection().anchorNode;return 3==t.nodeType?t.parentNode:t},t.prototype._getBlockID=function(t){return t.dataset.block},t.prototype._setBlockID=function(t){var e=this._generateNewBlockID();return t.setAttribute("data-block",e),e},t.prototype._generateNewBlockID=function(){return Math.random().toString(36).substr(2,9)},t.prototype._findBlocks=function(t,e){return t.querySelectorAll(e.join(","))},t}();e.EditorManager=l},726:(t,e)=>{e.__esModule=!0,e.HeaderTagSize=void 0,function(t){t.H1="h1",t.H2="h2",t.H3="h3",t.H4="h4",t.H5="h5",t.H6="h6"}(e.HeaderTagSize||(e.HeaderTagSize={}))},305:(t,e)=>{var n;e.__esModule=!0,e.blockTags=e.DefaultBlockTags=void 0,function(t){t.P="p",t.DIV="div",t.UL="ul",t.H1="h1",t.H2="h2",t.H3="h3",t.H4="h4",t.H5="h5",t.H6="h6"}(n=e.DefaultBlockTags||(e.DefaultBlockTags={})),e.blockTags=[n.P,n.DIV,n.UL,n.H1,n.H2,n.H3,n.H4,n.H5,n.H6]},969:(t,e)=>{e.__esModule=!0,e.HashTagPlugin=void 0;e.HashTagPlugin=function(t,e){var n=t.block,o=n.lastWord(),r=(n.lastChar(),n.rawHTML());if(o&&/(?:^|\s)#[^\s.,;:!?]+/i.test(o)){var i=o.replace(/#([^\s.,;:!?]+)/gi,(function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];var i=n.decodeHtml(o[0]||"").trim();return console.log("*** FOUND HASHTAG",i),i?e?e.format(i):'<a href="https://twitter.com/hashtag/'+i+'" contenteditable="false" target="_blank">#'+i+"</a>":t})),l=document.createElement("div");l.innerHTML=i,t.block.applyAttributes(e.attributes,l),t.block.applyStyes(e.styles,l),t.block.applyClasses(e.classes,l),i=l.innerHTML,l.remove(),n.publish(r.slice(0,r.lastIndexOf(o))+i)}}},9:(t,e)=>{e.__esModule=!0,e.LinkPlugin=void 0;e.LinkPlugin=function(t,e){var n=t.block,o=n.lastWord(),r=(n.lastChar(),n.rawHTML());if(o&&e&&e.format){var i=/([A-Za-z]{3,9}:(?:\/\/)?){0,}(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]/.exec(o);if(i&&i.length>0){console.log(i);var l=!!i[1],s=e.transform?e.transform(i[0],l):i[0],a=s.replace(/^http[s]{0,1}:\/\//,""),c=e.format(s,a);n.publish(r.slice(0,r.lastIndexOf(o))+c)}}}},328:(t,e)=>{e.__esModule=!0,e.HeaderPlugin=void 0;e.HeaderPlugin=function(t,e){console.log("*** HEADER PLUGIN CALLED");var n=t.block;if((console.log({minLength:n.rawText().length>=(e&&e.minLength||5),minWords:n.allWords().length>=(e&&e.minWords||3)}),n.rawText().length>=(e&&e.minLength||5)&&n.allWords().length>=(e&&e.minWords||3))&&!1===".?!,;:()[]".split("").some((function(t){return-1!==n.rawText().indexOf(t)}))){var o=document.createElement("h1");o.innerHTML=n.rawHTML(),o.dataset.block=t.block.blockElement.dataset.block,t.block.blockElement.parentNode.replaceChild(o,t.block.blockElement),t.block.blockElement.remove(),t.block.blockElement=o,t.block.applyAttributes(e.attributes),t.block.applyStyes(e.styles),t.block.applyClasses(e.classes)}}},519:(t,e,n)=>{e.__esModule=!0,e.extend=e.register=void 0;var o=n(962),r=n(726),i=new o.App;e.register=function(t,e,n){i.register(t,{trigger:e,exec:n})};e.extend=function(t,e){i.extend(t,e)},e.extend("hashtag",{format:function(t){return'<a href="https://twitter.com/hashtag/'+t+'" contenteditable="false" target="_blank">#'+t+"</a>"}}),e.extend("link",{transform:function(t,e){return e?t:"https://"+t},format:function(t,e){return'<a href="'+t+'" contenteditable="false" target="_blank">'+e+"</a>"}}),e.extend("header",{tag:r.HeaderTagSize.H1,minWords:4,styles:{color:"blue","border-bottom":"3px solid red"},classes:["header-style","bolder-please"]})}},e={};return function n(o){if(e[o])return e[o].exports;var r=e[o]={exports:{}};return t[o](r,r.exports,n),r.exports}(519)})()}));